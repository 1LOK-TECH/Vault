<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vault - Login</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="login-container-split fade-in">
    <!-- Left Side - Form -->
    <div class="login-left">
      <div class="login-form-wrapper">
        <h1 class="vault-title">Vault</h1>
        <p class="vault-subtitle">Secure Password Manager</p>

        <!-- Email/Password Form -->
        <form id="loginFormElement">
          <div class="form-group">
            <input 
              type="email" 
              id="email" 
              placeholder="Email" 
              required
              autocomplete="email"
            >
          </div>
          <div class="form-group">
            <input 
              type="password" 
              id="password" 
              placeholder="Password" 
              required
              autocomplete="current-password"
            >
          </div>
          
          <!-- Button Group -->
          <div class="button-group">
            <button type="button" class="gradient-border" id="registerBtn">Register</button>
            <button type="submit" class="btn-primary">Login</button>
          </div>
        </form>

        <!-- Error Message -->
        <div id="errorMessage" style="margin-top: 20px; color: #ef4444; text-align: center; display: none;"></div>
      </div>
    </div>

    <!-- Divider -->
    <div class="login-divider"></div>

    <!-- Right Side - Logo -->
    <div class="login-right">
      <img src="../assets/icon.png" alt="Vault Logo" class="login-logo-large">
      <p class="copyright-notice">Â© 2026 1LOK. All rights reserved. No part of this Vault distribution provided via GitHub may be reproduced, distributed, or transmitted in any form or by any means without the prior written permission of 1LOK. See README.md for our contact email if you wish to distribute or perform content creation.</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword,
      setPersistence,
      browserLocalPersistence
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // Import Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    
    // Set auth persistence to LOCAL (persists even after browser close)
    setPersistence(auth, browserLocalPersistence)
      .then(() => {
        console.log('Auth persistence set to LOCAL');
      })
      .catch((error) => {
        console.error('Error setting persistence:', error);
      });

    // DOM Elements
    const loginForm = document.getElementById('loginFormElement');
    const registerBtn = document.getElementById('registerBtn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const errorMessage = document.getElementById('errorMessage');

    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 5000);
    }

    // Email/Password Login
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = emailInput.value;
      const password = passwordInput.value;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        console.log('Login successful:', userCredential.user);
        // Store user info
        localStorage.setItem('userId', userCredential.user.uid);
        localStorage.setItem('userEmail', userCredential.user.email);
        // Navigate to master password screen
        window.location.href = 'master-password.html';
      } catch (error) {
        console.error('Login error:', error);
        showError('Login failed: ' + error.message);
      }
    });

    // Register Button
    registerBtn.addEventListener('click', async () => {
      const email = emailInput.value;
      const password = passwordInput.value;

      if (!email || !password) {
        showError('Please enter email and password');
        return;
      }

      if (password.length < 6) {
        showError('Password must be at least 6 characters');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        console.log('Registration successful:', userCredential.user);
        // Store user info
        localStorage.setItem('userId', userCredential.user.uid);
        localStorage.setItem('userEmail', userCredential.user.email);
        // Navigate to master password screen (to create master password)
        window.location.href = 'master-password.html';
      } catch (error) {
        console.error('Registration error:', error);
        showError('Registration failed: ' + error.message);
      }
    });
  </script>
</body>
</html>
